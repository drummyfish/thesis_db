<html>

  <!-- NOTE!!! Chromium has to be run with flags: --args --disable-web-security --allow-file-access-from-files  -->

  <head>
    <meta charset="ISO-8859-1">

    <style>
      body
        {
          font-family: Arial, Helvetica, sans-serif;
        }

      #thesis_list td
        {
          border: 1px solid black;
          padding: 5px;
        }

      #thesis_list
        {
          border-collapse: collapse;
        }

      #thesis_detail
        {
          background-color: rgb(240,240,240);
          border-radius: 10px;
          padding: 30px;
          position: fixed;
          display: block;
          top: 20px;
          left: 20px;
          height: 400px;
          width: 400px;
          box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
          visibility: hidden;
        }

      #info_info
        {
          font-size: 18px;
        }

      #thesis_detail span
        {
          display: block;
          margin-bottom: 10px;
          width: 100%;
        }

      #info_title_cs, #info_title_en
        {
          font-size: 18px;
          font-weight: bold;
        }

      #info_abstract_cs, #info_abstract_en
        {
          font-size: 11px;
        }

      #info_keywords
        {
          font-size: 12px;
          border-bottom: 1px solid black;
          padding-bottom: 10px;
        }

      a
        {
          text-decoration: none;
        }

      input[type="number"]
        {
          width: 60px;
        }

      form
        {
          font-size: 10px;
          background-color: rgb(0,0,0);
          padding: 20px;
          border-radius: 10px;
          margin: 30px;
        }

      form table
        {
          border-collapse: collapse;
          table-layout: fixed;
          width: 100%;
          color: white;
        }

      form table td
        {
          padding: 3px 0;
        }

      .tab
        {
          display: inline-block;
          width: 100px;
          height: 30px;
          padding: 0;
          margin: 0;
        }

       .search
        {
          width: 100%;
          height: 30px;
          font-weight: bold;
        }

    </style>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

    <script>
      theses = null;
      current_list = null;

      function person_to_string(person)
        {
          var result = "";

          for (var i in person.degrees)
            result += person.degrees[i] + " ";

          result += person.name_first + " " + person.name_last;

          return result;
        }

      function to_str(thing)
        {
          if (thing == null) 
            return "";

          return "" + thing;
        }

      function sort_theses(thesis_list)
        {
          var sort_by = $("select[name=sort_by]").val();

          var desc = checkbox_checked("do_descending");

          sort_year = function(a,b)
            {
              if (!desc)
                return (a.year == null ? 0 : a.year) - (b.year == null ? 0 : b.year);
              
              return (b.year == null ? 0 : b.year) - (a.year == null ? 0 : a.year); 
            };

          sort_title = function(a,b)
            {
              var s1 = ("" + a.title_cs).toLowerCase();
              var s2 = ("" + b.title_cs).toLowerCase();

              if (desc)
                return s2.localeCompare(s1);  

              return s1.localeCompare(s2);  
            };

          sort_author = function(a,b)
            {
              var s1 = ("" + a.author.name_last + a.author.name_first).toLowerCase();
              var s2 = ("" + b.author.name_last + a.author.name_first).toLowerCase();

              if (desc)
                return s2.localeCompare(s1);  

              return s1.localeCompare(s2);  
            };

          if (sort_by == 0)
            sort_func = sort_year;
          else if (sort_by == 1)
            sort_func = sort_title;
          else
            sort_func = sort_author;

          thesis_list.sort(sort_func);

          return thesis_list;
        }

      function shorten(text,length)
        {
          if (text.length <= length)
            return text;

          return text.substring(0,length - 1) + "...";
        }

      function display_info(index)
        {
          $("#thesis_detail").css("visibility","visible");

          var thesis = current_list[index];

          $("#info_title_cs").html(to_str(thesis.title_cs));
          $("#info_title_en").html(to_str(thesis.title_en));

          var info_str = "";

          if (thesis.kind != null)
            info_str += thesis.kind + " thesis";
 
            if (thesis.degree != null)
              info_str += " (" + thesis.degree + ")";

            info_str += ", ";

          info_str += person_to_string(thesis.author) + ", " + thesis.faculty; 
          
          if (thesis.year != null)
            info_str += " " + to_str(thesis.year);
          
          if (thesis.supervisor != null)
            info_str += ", superv. " + person_to_string(thesis.supervisor);

          if (thesis.pages != null)
            info_str += ", " + to_str(thesis.pages) + " pages";

          if (thesis.opponents.length != 0)
            info_str += ", opponents:"
 
            for (var o in thesis.opponents)
              info_str += " " + person_to_string(thesis.opponents[o]);

          $("#info_info").html(info_str);
          $("#info_abstract_cs").html(shorten(to_str(thesis.abstract_cs),320));
          $("#info_abstract_en").html(shorten(to_str(thesis.abstract_en),320));
          $("#info_keywords").html(thesis.keywords.join(", "));
        }

      function hide_info()
        {
          $("#thesis_detail").css("visibility","hidden");
        }

      function display_thesis_list(thesis_list)
        {
          $("#thesis_list").empty();

          var c = 0;

          for (var i in thesis_list)
            {
              var t = thesis_list[i];

              table_row = "<tr> " +
                "<td>" + to_str(t.degree) + "</td>" +
                "<td>" + to_str(t.faculty) + "</td>" +
                "<td>" + to_str(t.language) + "</td>" +
                "<td>" + person_to_string(t.author) + "</td>" +
                "<td>" + person_to_string(t.supervisor) + "</td>" +
                "<td>" + to_str(t.grade) + "</td>" +
                "<td onmouseenter=\"display_info(" + c + ")\" onmouseleave=\"hide_info()\"> <a href=\"" + t.url_page + "\">" +  (t.title_cs != null ? t.title_cs : t.tile_en) + "</a> </td>";

              if (t.url_fulltext != null)
                table_row += "<td> <a href=\"" + t.url_fulltext + "\"> full </a> </td>"
              else
                table_row += "<td> </td>"

              table_row += "<td>" + to_str(t.year) + "</td>" +
                "<td>" + to_str(t.pages) + "</td>" +
                "</tr>";

              $("#thesis_list").append(table_row);

              c += 1;
            }
        }

      $.getJSON("theses.json", function(json)
        {
          theses = json;
        });

      function input_value(input_name)
        {
          return $("input[name=" + input_name + "]").val();
        }

      function checkbox_checked(checkbox_name)
        {
          return $("input[name=" + checkbox_name + "]").is(":checked");
        }

      function strings_contain(what, strings)
        {
          for (j in strings)
            {
              if (strings[j] && strings[j].toLowerCase().indexOf(what) >= 0)
                return true;
            }

          return false;
        }

      function meets_criteria(thesis)
        {
          if (!thesis)
            return false;

          var search_for = input_value("search_for").trim().toLowerCase();

          if (search_for.length != 0)
            {
              var search_strings = [];

              if (checkbox_checked("do_title"))
                {
                  search_strings.push(thesis.title_cs);
                  search_strings.push(thesis.title_en);
                }
 
              if (checkbox_checked("do_abstract"))
                {
                  search_strings.push(thesis.abstract_cs);
                  search_strings.push(thesis.abstract_en);
                }

              if (checkbox_checked("do_keywords"))
                {
                  search_strings = search_strings.concat(thesis.keywords);
                }

              if (checkbox_checked("do_names"))
                {
                  search_strings.push(person_to_string(thesis.author));
                  search_strings.push(person_to_string(thesis.supervisor));

                  for (var k in thesis.opponents)
                    search_strings.push(person_to_string(thesis.opponents[k]));
                }

              if (!strings_contain(search_for,search_strings))
                return false;
            }

          if (!checkbox_checked("do_bachelor") && thesis.kind == "bachelor")
            return false;

          if (!checkbox_checked("do_master") && thesis.kind == "master")
            return false;

          if (!checkbox_checked("do_dr") && thesis.kind == "small doctorate")
            return false;

          if (!checkbox_checked("do_phd") && thesis.kind == "PhD")
            return false;

          if (!checkbox_checked("do_doc") && thesis.kind == "habilitation")
            return false;

          if (!checkbox_checked("do_grade_unknown") && thesis.grade == null)
            return false;

          if (thesis.grade == "A" && !checkbox_checked("do_a"))
            return false;

          if (thesis.grade == "B" && !checkbox_checked("do_b"))
            return false;

          if (thesis.grade == "C" && !checkbox_checked("do_c"))
            return false;

          if (thesis.grade == "D" && !checkbox_checked("do_d"))
            return false;

          if (thesis.grade == "E" && !checkbox_checked("do_e"))
            return false;

          if (thesis.grade == "F" && !checkbox_checked("do_f"))
            return false;

          if (thesis.language == null && !checkbox_checked("do_lang_unknown"))
            return false;

          if (thesis.language == "cs" && !checkbox_checked("do_cs"))
            return false;

          if (thesis.language == "sk" && !checkbox_checked("do_sk"))
            return false;
          
          if (thesis.language == "en" && !checkbox_checked("do_en"))
            return false;
         
          if (thesis.faculty == "FIT BUT")
            {
              if (!checkbox_checked("do_fit_but"))
                return false;
            }
          else if (thesis.faculty == "FI MUNI")
            {
              if (!checkbox_checked("do_fi_muni"))
                return false;
            }
          else if (thesis.faculty == "MFF CUNI")
            {
              if (!checkbox_checked("do_mff_cuni"))
                return false;
            }
          else if (thesis.faculty == "FIT CTU") 
            {
              if (!checkbox_checked("do_fit_ctu"))
                return false;
            }
          else if (thesis.faculty == "FELK CTU")
            {
              if (!checkbox_checked("do_felk_ctu"))
                return false;
            }
          else if (thesis.faculty.substring(0,4) == "FEI ")
            {
              if (!checkbox_checked("do_fei_vsb"))
                return false;
            }
          else if (thesis.faculty == "FAI UTB")
            {
              if (!checkbox_checked("do_fai_utb"))
                return false;
            }
          else if (thesis.faculty == "PEF MENDELU")
            {
              if  (!checkbox_checked("do_pef_mendelu"))
                return false;
            }
          else if (thesis.faculty == "Unicorn College")
            {
              if (!checkbox_checked("do_uc"))
                return false;
            }
          else if (!checkbox_checked("do_faculty_other"))
            return false;


          return true;
        }

      function search_clicked()
        {
          var result = [];

          for (i in theses)
            {
              if (meets_criteria(theses[i]))
                result.push(theses[i]);
            }

          current_list = sort_theses(result);

          display_thesis_list(current_list);
        }

    </script>

  </head>

  <body>
    <div id="thesis_detail">
      <span id="info_title_cs"></span>
      <span id="info_title_en"></span>
      <span id="info_info"></span>
      <span id="info_keywords"></span>
      <span id="info_abstract_cs"></span>
      <span id="info_abstract_en"></span>
    </div>

    <h1> Czech Computer Science Theses </h1>

    <form>
      <table>
        <tr>
          <td colspan="3"> search for: <input type="text" name="search_for"> </td>
          <td colspan="3"> max results: <input type="number" name="max_results" value="50"> </td>
          <td colspan="2">
            sort by
            <select name="sort_by">
              <option value="0"> year </option>
              <option value="1"> title </option>
              <option value="2"> author </option>
            </select>
          </td>
          <td> <input type="checkbox" name="do_descending" checked="checked"> desc. </td>
          <td></td>
          <td></td>
        </tr>

        <tr>
          <td> search </td>
          <td> <input type="checkbox" name="do_title" checked="checked"> title </td>
          <td> <input type="checkbox" name="do_names" checked="checked"> names </td>
          <td> <input type="checkbox" name="do_keywords" checked="checked"> keyw. </td>
          <td> <input type="checkbox" name="do_abstract" checked="checked"> abstr. </td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
        </tr>

        <tr>
          <td> type </td>
          <td> <input type="checkbox" name="do_bachelor" checked="checked"> Bc. </td>
          <td> <input type="checkbox" name="do_master" checked="checked"> master </td>
          <td> <input type="checkbox" name="do_dr" checked="checked"> dr. </td>
          <td> <input type="checkbox" name="do_phd" checked="checked"> PhD. </td>
          <td> <input type="checkbox" name="do_doc" checked="checked"> doc. </td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
        </tr>

        <tr>
          <td> grade </td>
          <td> <input type="checkbox" name="do_a" checked="checked"> A </td>
          <td> <input type="checkbox" name="do_b" checked="checked"> B </td>
          <td> <input type="checkbox" name="do_c" checked="checked"> C </td>
          <td> <input type="checkbox" name="do_d" checked="checked"> D </td>
          <td> <input type="checkbox" name="do_e" checked="checked"> E </td>
          <td> <input type="checkbox" name="do_f" checked="checked"> F </td>
          <td> <input type="checkbox" name="do_grade_unknown" checked="checked"> N/A </td>
          <td></td>
          <td></td>
          <td></td>
        </tr>

        <tr>
          <td> language </td>
          <td> <input type="checkbox" name="do_cs" checked="checked"> cs </td>
          <td> <input type="checkbox" name="do_sk" checked="checked"> sk </td>
          <td> <input type="checkbox" name="do_en" checked="checked"> en </td>
          <td> <input type="checkbox" name="do_lang_unknown" checked="checked"> N/A </td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
        </tr>

        <tr>
          <td>faculty </td>
          <td> <input type="checkbox" name="do_mff_cuni" checked="checked"> MFF CUNI </td>
          <td> <input type="checkbox" name="do_fit_ctu" checked="checked"> FIT CTU </td>
          <td> <input type="checkbox" name="do_fi_muni" checked="checked"> FI MUNI </td>
          <td> <input type="checkbox" name="do_felk_ctu" checked="checked"> FELK CTU </td>
          <td> <input type="checkbox" name="do_fit_but" checked="checked"> FIT BUT </td>
          <td> <input type="checkbox" name="do_fei_vsb" checked="checked"> FEI VSB </td>
          <td> <input type="checkbox" name="do_fai_utb" checked="checked"> FAI UTB </td>
          <td> <input type="checkbox" name="do_pef_mendelu" checked="checked"> PEF MEND </td>
          <td> <input type="checkbox" name="do_uc" checked="checked"> UC </td>
          <td> <input type="checkbox" name="do_faculty_other" checked="checked"> other </td>
        </tr>

        <tr>
          <td> city </td>
          <td> <input type="checkbox" name="do_praha" checked="checked"> Praha </td>
          <td> <input type="checkbox" name="do_brno" checked="checked"> Brno </td>
          <td> <input type="checkbox" name="do_ostrava" checked="checked"> Ostrava </td>
          <td> <input type="checkbox" name="do_zlin" checked="checked"> Zlin </td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
        </tr>

        <tr>
          <td> other </td>
          <td> <input type="checkbox" name="do_fulltext" checked="checked"> fulltext </td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
        </tr>

        <tr>
          <td> year </td>
          <td colspan="2"> year from: <input type="number" value="1990"> </td>
          <td colspan="2"> year to: <input type="number" value="2020"> </td>
          <td> <input type="checkbox" name="do_year_unknown" checked="checked"> unknown </td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
        </tr>

        <tr>
          <td colspan="11"> <input class="search" type="button" value="search" onclick="search_clicked()"> </td>
        </tr>
      </table>
    </form>

    <table id="thesis_list">
    </table>

  </body>

</html>
